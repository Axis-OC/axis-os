local a,b,c=component,computer,unicode;local d,e;for f,g in a.list()do if g=="gpu"then d=a.proxy(f)end;if g=="screen"then e=f end end;if not d or not e then b.beep(1000,0.2)error("NO GPU")end;d.bind(e)local h,i=d.maxResolution()d.setResolution(h,i)local j,k,l,m,n,o=0x0000AA,0xAA0000,0xFFFF00,0xFFFFFF,0xC0C0C0,0x000000;local p,q=0x00AA00,0x00AAAA;local r;for f in a.list("filesystem")do local s=a.proxy(f)if s.exists("/kernel.lua")then r=s;break end end;if not r then d.setBackground(o)d.setForeground(k)d.fill(1,1,h,i," ")d.set(1,1,"NO SYSTEM DISK")while true do b.pullSignal()end end;local function t(u)local v=r.open(u,"r")if not v then return nil end;local w={}while true do local x=r.read(v,4096)if not x then break end;w[#w+1]=x end;r.close(v)return table.concat(w)end;local y;local x=t("/boot/loader.cfg")if x then local f=load(x,"loader.cfg","t",{})if f then local z,A=pcall(f)if z then y=A end end end;if not y then y={timeout=3,default="axis",entries={{id="axis",title="AxisOS",kernel="/kernel.lua",init="/bin/init.lua",params={loglevel="Info"}}}}end;local B={"    _        _      ___  ____  ","   / \\  __ _(_)___ / _ \\/ ___| ","  / _ \\ \\ \\/ / / __| | | \\___ \\ "," / ___ \\ >  <| \\__ \\ |_| |___) |","/_/   \\_/_/\\_\\_|___/\\___/|____/ "}d.setBackground(o)d.setForeground(m)d.fill(1,1,h,i," ")d.set(1,1,"AxisBIOS v0.7-HV")d.set(1,2,"(C) 2025 Axis Corp")b.beep(1100,0.1)local C=math.floor(i/3)d.setForeground(n)for D,E in ipairs(B)do local F=math.floor((h-c.len(E))/2)d.set(F,C+D,E)end;d.setForeground(m)d.set(math.floor((h-24)/2),i-2,"Press DEL to enter SETUP")local G=y.timeout or 3;if G<0 then G=0 end;local H=b.uptime()+G;local I=false;while b.uptime()<H do local J,K,K,L=b.pullSignal(0.1)if J=="key_down"then if L==211 then I=true;break end;if L==28 then break end end end;if I then b.beep(1000,0.1)local M=t("/boot/setup.lua")if M then local N={component=a,computer=b,unicode=c,string=string,math=math,table=table,pairs=pairs,ipairs=ipairs,type=type,tostring=tostring,tonumber=tonumber,pcall=pcall,error=error,load=load,setmetatable=setmetatable}local f,O=load(M,"@setup","t",N)if f then pcall(f)else d.set(1,i,"Setup load error: "..tostring(O))end else d.set(1,i,"WARN: /boot/setup.lua not found")b.pullSignal(2)end;x=t("/boot/loader.cfg")if x then local P=load(x,"loader.cfg","t",{})if P then local z,A=pcall(P)if z then y=A end end end end;local Q=y.entries or{}local R=1;for D,e in ipairs(Q)do if e.id==y.default then R=D;break end end;if#Q>1 and not I then d.setBackground(o)d.setForeground(m)d.fill(1,1,h,i," ")d.setForeground(q)d.set(2,1,"AxisOS Boot Menu")d.setForeground(n)d.set(2,2,string.rep("=",h-2))local S=4;local T=true;while T do for D,e in ipairs(Q)do local U=S+D-1;if D==R then d.setBackground(m)d.setForeground(o)else d.setBackground(o)d.setForeground(n)end;local V="  "..e.title..string.rep(" ",math.max(1,h-4-#e.title))d.set(2,U,V)end;d.setBackground(o)d.setForeground(n)d.set(2,i-1,"Arrows:Select  Enter:Boot  e:Edit params")local J,K,W,L=b.pullSignal(5)if J=="key_down"then if L==200 and R>1 then R=R-1 elseif L==208 and R<#Q then R=R+1 elseif L==28 then T=false end elseif not J then T=false end end end;local X=Q[R]or Q[1]if not X then d.set(1,1,"No boot entries!")while true do b.pullSignal()end end;d.setBackground(o)d.setForeground(m)d.fill(1,1,h,i," ")d.set(1,1,"Booting: "..(X.title or"AxisOS"))local Y={lvl="Info",safe="Disabled",wait="0",quick="Disabled",init=X.init or"/bin/init.lua"}if X.params then if X.params.loglevel then Y.lvl=X.params.loglevel end;if X.params.safemode then Y.safe="Enabled"Y.safemode="Enabled"end end;local Z=X.kernel or"/kernel.lua"local _=r.open(Z,"r")if not _ then d.set(1,2,"FATAL: "..Z.." not found")while true do b.pullSignal()end end;b.beep(900,0.2)local a0={}while true do local x=r.read(_,math.huge)if not x then break end;a0[#a0+1]=x end;r.close(_)local a1=table.concat(a0)if a1:sub(1,3)=="\239\187\191"then a1=a1:sub(4)end;local N={raw_component=a,raw_computer=b,boot_fs_address=r.address,boot_args=Y}setmetatable(N,{__index=_G})local a2,O=load(a1,"=kernel","t",N)if not a2 then error(O)end;a2()