local a=component;local b=a.invoke;local c,d;for e in a.list("gpu")do c=e;break end;for e in a.list("screen")do d=e;break end;if c and d then b(c,"bind",d)end;if c then local f,g=b(c,"maxResolution")b(c,"setResolution",f,g)b(c,"setBackground",0)b(c,"fill",1,1,f,g," ")end;local h=1;local function i(j,k)if c then b(c,"setForeground",k or 0xFFFFFF)b(c,"set",1,h,j)h=h+1 end end;local function l(m)i("PANIC: "..m,0xFF0000)while true do computer.pullSignal(1)end end;local n={}for o=0,255 do local k=o;for p=1,8 do if k%2==1 then k=bit32.bxor(bit32.rshift(k,1),0xEDB88320)else k=bit32.rshift(k,1)end end;n[o]=k end;local function q(d)local k=0xFFFFFFFF;for o=1,#d do k=bit32.bxor(bit32.rshift(k,8),n[bit32.band(bit32.bxor(k,d:byte(o)),0xFF)])end;return bit32.bxor(k,0xFFFFFFFF)end;local function r(d,s)return d:byte(s)*256+d:byte(s+1)end;local function t(d,s)return d:byte(s)*0x1000000+d:byte(s+1)*0x10000+d:byte(s+2)*0x100+d:byte(s+3)end;i("AxisOS SecureBoot v1.0",0x00AAFF)local u;for e in a.list("drive")do u=e;break end;if not u then l("No drive")end;local v=b(u,"getSectorSize")local function w(x)return b(u,"readSector",x+1)end;local y=w(0)if not y or y:sub(1,4)~="ARDB"then l("No RDB")end;local z=y:byte(6)local A,B;for o=0,z-1 do local s=9+o*32;local C=y:sub(s,s+4):gsub("\0","")if C=="AXEFI"then A=t(y,s+8)B=t(y,s+12)break end end;if not A then l("No EFI partition")end;i("EFI @ sector "..A,0xAAAAAA)local D=w(A)if not D or D:sub(1,4)~="AEFI"then l("Bad EFI header")end;local E=r(D,6)local F=t(D,8)local G=r(D,12)local H=r(D,14)local I=r(D,16)local J=r(D,18)local K=D:byte(20)local L=t(D,53)if q(D:sub(1,52))~=L then l("EFI header CRC fail")end;i("Loading stage 3 ("..E.."B)...",0xFFFF00)local M={}for o=0,J-1 do local N=w(A+I+o)if N then M[#M+1]=N end end;local O=table.concat(M):sub(1,E)if q(O)~=F then l("Boot code CRC fail")end;i("CRC OK",0x00FF00)local P={_efi_drive=u,_efi_off=A,_efi_sz=B,_efi_sb=K,_efi_ss=v,_rdb=y,component=a,computer=computer,bit32=bit32,math=math,string=string,table=table,os=os,pairs=pairs,ipairs=ipairs,type=type,tostring=tostring,tonumber=tonumber,pcall=pcall,xpcall=xpcall,error=error,load=load,select=select,next=next,rawset=rawset,rawget=rawget,rawequal=rawequal,rawlen=rawlen,setmetatable=setmetatable,getmetatable=getmetatable,coroutine=coroutine,debug=debug,unpack=unpack or table.unpack}P._G=P;P._ENV=P;local Q,R=load(O,"=efi/boot","t",P)if not Q then l("Stage3: "..tostring(R))end;i("Entering stage 3...",0x00FF00)Q()