local a,b=component,computer;local c,d,e,f,g;for h,i in a.list()do local j=a.proxy(h)if i=="gpu"and not c then c=j elseif i=="screen"and not d then d=h elseif i=="eeprom"and not e then e=j elseif i=="data"and not f then f=j elseif i=="filesystem"and not g then if j.exists("/kernel.lua")then g=j end end end;if not c or not d then b.beep(1000,.2)error("NO GPU")end;c.bind(d)local k,l=c.maxResolution()c.setResolution(k,l)c.setBackground(0)c.setForeground(0xFFFFFF)c.fill(1,1,k,l," ")local m,n,o=1,math.floor,string.format;local function p(q,r)if r then c.setForeground(r)end;c.set(2,m,tostring(q))m=m+1 end;local function s(t)c.setForeground(0xFF0000)c.set(2,l-2,"SECURE BOOT FAILURE")c.setForeground(0xFF5555)c.set(2,l-1,tostring(t):sub(1,k-4))b.beep(200,1)while true do b.pullSignal(math.huge)end end;local function u(q)local i={}for v=1,#q do i[v]=o("%02x",q:byte(v))end;return table.concat(i)end;local function w(x)local y=g.open(x,"r")if not y then return end;local i={}while true do local q=g.read(y,4096)if not q then break end;i[#i+1]=q end;g.close(y)return table.concat(i)end;if not g then s("No system disk")end;p("AxisOS Secure Boot v1.0",0x00BCD4)p(string.rep("=",36),0x333333)p("")local z={v=false,b="",k=""}if f then p("[1/3] Machine binding...",0xAAAAAA)z.b=u(f.sha256((f.address or"")..(e and e.address or"")..(g.address or"")))p("  "..z.b:sub(1,20).."...",0x55FF55)p("[2/3] Kernel integrity...",0xAAAAAA)local A=w("/kernel.lua")if not A or#A<100 then s("Kernel corrupt")end;z.k=u(f.sha256(A))z.v=true;p("  "..z.k:sub(1,20).."...",0x55FF55)p("[3/3] Manifest...",0xAAAAAA)local B=w("/boot/manifest.sig")p("  "..(B and"PRESENT"or"(none)"),B and 0x55FF55 or 0xFFAA00)else p("No data card - verification skipped",0xFFAA00)if not w("/kernel.lua")then s("No kernel")end end;p("")c.setForeground(0xC0C0C0)for C,D in ipairs({"    _        _      ___  ____  ","   / \\  __ _(_)___ / _ \\/ ___| ","  / _ \\ \\ \\/ / / __| | | \\___ \\ "," / ___ \\ >  <| \\__ \\ |_| |___) |","/_/   \\_/_/\\_\\_|___/\\___/|____/ "})do c.set(n((k-#D)/2),m,D)m=m+1 end;p("")p("AxisOS v0.5",0xFFFFFF)c.setForeground(0xAAAAAA)c.set(n((k-24)/2),l-2,"Press DEL for BIOS Setup")c.setForeground(z.v and 0x55FF55 or 0xFFAA00)c.set(2,l,"SB: "..(z.v and"VERIFIED"or"UNVERIFIED"))local E=b.uptime()+3;while b.uptime()<E do local F,C,C,G=b.pullSignal(.1)if F=="key_down"then if G==211 then b.beep(1000,.1)local H=w("/boot/setup.lua")if H then local I=load(H,"@setup","t",{component=a,computer=b,unicode=unicode,string=string,math=math,table=table,pairs=pairs,ipairs=ipairs,type=type,tostring=tostring,tonumber=tonumber,pcall=pcall,error=error,load=load,setmetatable=setmetatable,select=select,next=next})if I then pcall(I)end end;break elseif G==28 then break end end end;c.fill(1,1,k,l," ")c.set(1,1,"Booting...")b.beep(900,.2)local A=w("/kernel.lua")if not A or#A<100 then s("Kernel missing")end;if A:sub(1,3)=="\239\187\191"then A=A:sub(4)end;local J={lvl="Info",safe="Disabled",wait="0",init="/bin/init.lua"}do local K=w("/boot/loader.cfg")if K then local I=load(K,"loader.cfg","t",{})if I then local L,M=pcall(I)if L and M and M.entries then for C,N in ipairs(M.entries)do if N.id==(M.default or"axis")then if N.init then J.init=N.init end;if N.params then if N.params.loglevel then J.lvl=N.params.loglevel end;if N.params.safemode then J.safe="Enabled"end end;break end end end end end end;local O={raw_component=a,raw_computer=b,boot_fs_address=g.address,boot_args=J}if z.v then O.boot_security={machine_binding=z.b,kernel_hash=z.k,data_card_addr=f.address,verified=true}end;setmetatable(O,{__index=_G})local I,P=load(A,"=kernel","t",O)if not I then s("PARSE: "..tostring(P))end;local L,Q=xpcall(I,debug.traceback)if not L then s("PANIC: "..tostring(Q))end