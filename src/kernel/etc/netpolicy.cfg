-- /etc/netpolicy.lua
-- Network security policy. Processed top-to-bottom, first match wins.
-- Actions: "allow", "deny", "log" (allow + log)
--
-- Fields:
--   action   = "allow" | "deny" | "log"
--   proto    = "http" | "tcp" | "any"
--   host     = pattern string (Lua pattern) or "*"
--   port     = number or "*"
--   uid      = number or "*" (user ID)
--   ring     = number or "*"
--   comment  = string
--
return {
  -- Default policies per ring
  { action = "allow", proto = "any", host = "*", port = "*",
    ring = 0, comment = "Ring 0: unrestricted" },
  { action = "allow", proto = "any", host = "*", port = "*",
    ring = 1, comment = "Ring 1: unrestricted" },
  { action = "allow", proto = "any", host = "*", port = "*",
    ring = 2, comment = "Ring 2: unrestricted" },

  -- Block known bad domains
  { action = "deny", proto = "http", host = ".*malware%.example%.com",
    port = "*", ring = "*", comment = "Block malware domain" },

  -- Rate-limit: max 5 concurrent sessions per UID (enforced in driver)
  -- (This is a hint, enforcement is in the policy engine)

  -- Allow HTTP/HTTPS for user-mode
  { action = "allow", proto = "http", host = "*", port = "*",
    ring = 3, comment = "Allow HTTP for Ring 3" },

  -- Block raw TCP for unprivileged users (except port 80/443)
  { action = "allow", proto = "tcp", host = "*", port = 80,
    ring = 3, comment = "TCP 80 allowed" },
  { action = "allow", proto = "tcp", host = "*", port = 443,
    ring = 3, comment = "TCP 443 allowed" },
  { action = "deny", proto = "tcp", host = "*", port = "*",
    ring = 3, comment = "Block other TCP for Ring 3" },

  -- Default: allow everything else
  { action = "allow", proto = "any", host = "*", port = "*",
    ring = "*", comment = "Default allow" },
}